logger:
  level: info
  file: ./output_logs.log
{"level":"info","ts":"2021-08-06T21:05:40.281+0300","caller":"otus_project/main.go:31","msg":"Banner rotation service successfully started"}
{"level":"info","ts":"2021-08-15T03:23:25.915+0300","caller":"otus_project/main.go:45","msg":"Banner rotation service is starting..."}
{"level":"info","ts":"2021-08-15T03:23:25.917+0300","caller":"otus_project/main.go:49","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-15T03:24:12.325+0300","caller":"otus_project/main.go:45","msg":"Banner rotation service is starting..."}
{"level":"info","ts":"2021-08-15T03:24:12.326+0300","caller":"otus_project/main.go:49","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-15T03:25:05.075+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-15T03:25:05.076+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-15T03:29:31.711+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-15T03:29:31.712+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-15T03:29:31.734+0300","caller":"otus_project/main.go:56","msg":"rotation service storage started"}
{"level":"info","ts":"2021-08-15T03:29:31.735+0300","caller":"server/server.go:178","msg":"GRPC server starting...","address":"localhost:56789"}
{"level":"error","ts":"2021-08-15T03:34:35.059+0300","caller":"zap/options.go:212","msg":"finished unary call with code Internal","grpc.start_time":"2021-08-15T03:34:35+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddBannerToSlot","error":"rpc error: code = Internal desc = failed to add banner to slot: error during adding banner to slot: error during sql execution: ERROR: invalid input syntax for type uuid: \"123\" (SQLSTATE 22P02)","grpc.code":"Internal","grpc.time_ms":25.125,"stacktrace":"github.com/grpc-ecosystem/go-grpc-middleware/logging/zap.DefaultMessageProducer\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/options.go:212\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:39\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddBannerToSlot_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:218\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"error","ts":"2021-08-15T03:37:36.399+0300","caller":"sql/sql.go:116","msg":"error closing sql rows object","stacktrace":"github.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddBanner.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:116\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:129\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.AddBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:99\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).AddBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:87\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddBanner_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:252\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:254\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"error","ts":"2021-08-15T03:37:36.402+0300","caller":"zap/options.go:212","msg":"finished unary call with code Internal","grpc.start_time":"2021-08-15T03:37:36+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddBanner","error":"rpc error: code = Internal desc = failed to add banner: error during retrieving created banner: sql execution error: ERROR: syntax error at end of input (SQLSTATE 42601)","grpc.code":"Internal","grpc.time_ms":40.40999984741211,"stacktrace":"github.com/grpc-ecosystem/go-grpc-middleware/logging/zap.DefaultMessageProducer\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/options.go:212\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:39\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:254\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T04:56:37.094+0300","caller":"server/server.go:191","msg":"GRPC server stopping..."}
{"level":"info","ts":"2021-08-15T04:56:37.097+0300","caller":"server/server.go:193","msg":"GRPC server stopped"}
{"level":"info","ts":"2021-08-15T04:56:37.097+0300","caller":"otus_project/main.go:73","msg":"rotation service stopped"}
{"level":"info","ts":"2021-08-15T04:57:09.013+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-15T04:57:09.013+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-15T04:57:09.030+0300","caller":"otus_project/main.go:56","msg":"rotation service storage started"}
{"level":"info","ts":"2021-08-15T04:57:09.030+0300","caller":"server/server.go:178","msg":"GRPC server starting...","address":"localhost:56789"}
{"level":"error","ts":"2021-08-15T04:57:38.621+0300","caller":"sql/sql.go:116","msg":"error closing sql rows object","stacktrace":"github.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddBanner.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:116\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:129\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.AddBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:99\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).AddBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:87\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddBanner_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:252\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:254\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T04:57:38.627+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T04:57:38+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddBanner","grpc.code":"OK","grpc.time_ms":25.878000259399414}
{"level":"error","ts":"2021-08-15T04:57:53.008+0300","caller":"sql/sql.go:57","msg":"error closing sql rows object","stacktrace":"github.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddSlot.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:57\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddSlot\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:70\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.AddSlot\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:47\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).AddSlot\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:34\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddSlot_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:288\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddSlot_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:290\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T04:57:53.013+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T04:57:52+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddSlot","grpc.code":"OK","grpc.time_ms":32.48500061035156}
{"level":"error","ts":"2021-08-15T04:58:14.117+0300","caller":"zap/options.go:212","msg":"finished unary call with code Internal","grpc.start_time":"2021-08-15T04:58:14+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddBannerToSlot","error":"rpc error: code = Internal desc = failed to add banner to slot: error during adding banner to slot: error during sql execution: ERROR: insert or update on table \"slot_banners\" violates foreign key constraint \"slot_banners_slot_id_fkey\" (SQLSTATE 23503)","grpc.code":"Internal","grpc.time_ms":25.677000045776367,"stacktrace":"github.com/grpc-ecosystem/go-grpc-middleware/logging/zap.DefaultMessageProducer\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/options.go:212\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:39\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddBannerToSlot_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:218\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T04:59:48.864+0300","caller":"server/server.go:191","msg":"GRPC server stopping..."}
{"level":"info","ts":"2021-08-15T04:59:48.865+0300","caller":"server/server.go:193","msg":"GRPC server stopped"}
{"level":"info","ts":"2021-08-15T04:59:48.865+0300","caller":"otus_project/main.go:73","msg":"rotation service stopped"}
{"level":"info","ts":"2021-08-15T04:59:52.859+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-15T04:59:52.859+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-15T04:59:52.886+0300","caller":"otus_project/main.go:56","msg":"rotation service storage started"}
{"level":"info","ts":"2021-08-15T04:59:52.886+0300","caller":"server/server.go:178","msg":"GRPC server starting...","address":"localhost:56789"}
{"level":"info","ts":"2021-08-15T05:00:06.113+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T05:00:06+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddBannerToSlot","grpc.code":"OK","grpc.time_ms":21.249000549316406}
{"level":"info","ts":"2021-08-15T05:01:56.133+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T05:01:56+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"DeleteBanner","grpc.code":"OK","grpc.time_ms":13.00100040435791}
{"level":"error","ts":"2021-08-15T05:02:26.232+0300","caller":"sql/sql.go:236","msg":"error closing sql rows object","stacktrace":"github.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddGroup.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:236\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddGroup\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:248\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.AddGroup\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:124\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).AddGroup\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:108\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddGroup_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:324\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddGroup_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:326\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T05:02:26.240+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T05:02:26+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddGroup","grpc.code":"OK","grpc.time_ms":26.09600067138672}
{"level":"info","ts":"2021-08-15T05:03:04.846+0300","caller":"zap/options.go:212","msg":"finished unary call with code InvalidArgument","grpc.start_time":"2021-08-15T05:03:04+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"NextBanner","error":"rpc error: code = InvalidArgument desc = group id is empty","grpc.code":"InvalidArgument","grpc.time_ms":0.07699999958276749}
{"level":"error","ts":"2021-08-15T05:03:28.560+0300","caller":"zap/options.go:212","msg":"finished unary call with code Internal","grpc.start_time":"2021-08-15T05:03:28+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"NextBanner","error":"rpc error: code = Internal desc = failed to get next banner to show: failed to find banners by slot: error during sql execution: could not find name slotId in map[string]interface {}{\"slotID\":\"8f83ec0f-8462-427e-bd72-8bba76719a18\"}","grpc.code":"Internal","grpc.time_ms":0.39500001072883606,"stacktrace":"github.com/grpc-ecosystem/go-grpc-middleware/logging/zap.DefaultMessageProducer\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/options.go:212\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:39\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:380\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T05:04:33.916+0300","caller":"server/server.go:191","msg":"GRPC server stopping..."}
{"level":"info","ts":"2021-08-15T05:04:33.916+0300","caller":"server/server.go:193","msg":"GRPC server stopped"}
{"level":"info","ts":"2021-08-15T05:04:33.917+0300","caller":"otus_project/main.go:73","msg":"rotation service stopped"}
{"level":"info","ts":"2021-08-15T05:04:37.197+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-15T05:04:37.197+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-15T05:04:37.214+0300","caller":"otus_project/main.go:56","msg":"rotation service storage started"}
{"level":"info","ts":"2021-08-15T05:04:37.214+0300","caller":"server/server.go:178","msg":"GRPC server starting...","address":"localhost:56789"}
{"level":"error","ts":"2021-08-15T05:04:48.444+0300","caller":"sql/sql.go:397","msg":"error closing sql rows object","stacktrace":"github.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).GetShowsAmount.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:397\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).GetShowsAmount\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:409\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.NextBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:169\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).NextBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:148\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:378\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:380\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T05:04:48.445+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T05:04:48+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"NextBanner","grpc.code":"OK","grpc.time_ms":34.87300109863281}
{"level":"error","ts":"2021-08-15T05:04:57.275+0300","caller":"sql/sql.go:397","msg":"error closing sql rows object","stacktrace":"github.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).GetShowsAmount.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:397\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).GetShowsAmount\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:409\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.NextBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:169\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).NextBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:148\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:378\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:380\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T05:04:57.276+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T05:04:57+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"NextBanner","grpc.code":"OK","grpc.time_ms":5.985000133514404}
{"level":"info","ts":"2021-08-15T05:05:29.590+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T05:05:29+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"PersistClick","grpc.code":"OK","grpc.time_ms":26.3799991607666}
{"level":"info","ts":"2021-08-15T05:06:47.618+0300","caller":"server/server.go:191","msg":"GRPC server stopping..."}
{"level":"info","ts":"2021-08-15T05:06:47.619+0300","caller":"server/server.go:193","msg":"GRPC server stopped"}
{"level":"info","ts":"2021-08-15T05:06:47.619+0300","caller":"otus_project/main.go:73","msg":"rotation service stopped"}
{"level":"info","ts":"2021-08-15T05:06:49.652+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-15T05:06:49.652+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-15T05:06:49.668+0300","caller":"otus_project/main.go:56","msg":"rotation service storage started"}
{"level":"info","ts":"2021-08-15T05:06:49.669+0300","caller":"server/server.go:178","msg":"GRPC server starting...","address":"localhost:56789"}
{"level":"info","ts":"2021-08-15T23:14:56.650+0300","caller":"server/server.go:191","msg":"GRPC server stopping..."}
{"level":"info","ts":"2021-08-15T23:14:56.651+0300","caller":"server/server.go:193","msg":"GRPC server stopped"}
{"level":"info","ts":"2021-08-15T23:14:56.651+0300","caller":"otus_project/main.go:73","msg":"rotation service stopped"}
{"level":"info","ts":"2021-08-15T23:15:26.807+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-15T23:15:26.807+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-15T23:15:26.826+0300","caller":"otus_project/main.go:56","msg":"rotation service storage started"}
{"level":"info","ts":"2021-08-15T23:15:26.826+0300","caller":"server/server.go:180","msg":"GRPC server starting...","address":"localhost:56789"}
{"level":"info","ts":"2021-08-15T23:15:56.906+0300","caller":"server/server.go:193","msg":"GRPC server stopping..."}
{"level":"info","ts":"2021-08-15T23:15:56.906+0300","caller":"server/server.go:195","msg":"GRPC server stopped"}
{"level":"info","ts":"2021-08-15T23:15:56.906+0300","caller":"otus_project/main.go:73","msg":"rotation service stopped"}
{"level":"info","ts":"2021-08-15T23:16:11.397+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-15T23:16:11.397+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-15T23:16:11.435+0300","caller":"otus_project/main.go:56","msg":"rotation service storage started"}
{"level":"info","ts":"2021-08-15T23:16:11.435+0300","caller":"server/server.go:180","msg":"GRPC server starting...","address":"localhost:56789"}
{"level":"error","ts":"2021-08-15T23:16:24.854+0300","caller":"sql/sql.go:57","msg":"error closing sql rows object","stacktrace":"github.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddSlot.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:57\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddSlot\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:70\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.AddSlot\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:45\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).AddSlot\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddSlot_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:288\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddSlot_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:290\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T23:16:24.863+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T23:16:24+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddSlot","grpc.code":"OK","grpc.time_ms":33.29600143432617}
{"level":"error","ts":"2021-08-15T23:16:36.408+0300","caller":"sql/sql.go:116","msg":"error closing sql rows object","stacktrace":"github.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddBanner.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:116\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:129\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.AddBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:97\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).AddBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:86\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddBanner_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:252\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:254\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T23:16:36.415+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T23:16:36+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddBanner","grpc.code":"OK","grpc.time_ms":26.2549991607666}
{"level":"info","ts":"2021-08-15T23:16:55.584+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T23:16:55+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddBannerToSlot","grpc.code":"OK","grpc.time_ms":22.621000289916992}
{"level":"error","ts":"2021-08-15T23:17:03.916+0300","caller":"sql/sql.go:116","msg":"error closing sql rows object","stacktrace":"github.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddBanner.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:116\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:129\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.AddBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:97\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).AddBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:86\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddBanner_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:252\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:254\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T23:17:03.919+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T23:17:03+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddBanner","grpc.code":"OK","grpc.time_ms":7.88100004196167}
{"level":"info","ts":"2021-08-15T23:17:12.321+0300","caller":"zap/options.go:212","msg":"finished unary call with code InvalidArgument","grpc.start_time":"2021-08-15T23:17:12+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddBanner","error":"rpc error: code = InvalidArgument desc = description is empty","grpc.code":"InvalidArgument","grpc.time_ms":0.09200000017881393}
{"level":"info","ts":"2021-08-15T23:17:47.083+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T23:17:47+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddBannerToSlot","grpc.code":"OK","grpc.time_ms":5.9070000648498535}
{"level":"error","ts":"2021-08-15T23:18:15.901+0300","caller":"zap/options.go:212","msg":"finished unary call with code Internal","grpc.start_time":"2021-08-15T23:18:15+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"NextBanner","error":"rpc error: code = Internal desc = failed to get next banner to show: failed to store banner show: error during sql execution: ERROR: insert or update on table \"banner_stats\" violates foreign key constraint \"banner_stats_group_id_fkey\" (SQLSTATE 23503)","grpc.code":"Internal","grpc.time_ms":32.75,"stacktrace":"github.com/grpc-ecosystem/go-grpc-middleware/logging/zap.DefaultMessageProducer\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/options.go:212\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:39\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:380\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"error","ts":"2021-08-15T23:29:16.334+0300","caller":"sql/sql.go:206","msg":"error closing sql rows object","stacktrace":"github.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddGroup.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:206\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).AddGroup\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:218\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.AddGroup\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:122\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).AddGroup\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:108\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddGroup_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:324\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_AddGroup_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:326\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T23:29:16.341+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T23:29:16+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"AddGroup","grpc.code":"OK","grpc.time_ms":47.617000579833984}
{"level":"info","ts":"2021-08-15T23:29:33.649+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T23:29:33+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"NextBanner","grpc.code":"OK","grpc.time_ms":39.55799865722656}
{"level":"info","ts":"2021-08-15T23:29:55.148+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T23:29:55+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"NextBanner","grpc.code":"OK","grpc.time_ms":13.33899974822998}
{"level":"error","ts":"2021-08-15T23:33:11.979+0300","caller":"zap/options.go:212","msg":"finished unary call with code Internal","grpc.start_time":"2021-08-15T23:33:11+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"PersistClick","error":"rpc error: code = Internal desc = failed to persist click: failed to persist banner click stats: error during sql execution: ERROR: insert or update on table \"banner_stats\" violates foreign key constraint \"banner_stats_group_id_fkey\" (SQLSTATE 23503)","grpc.code":"Internal","grpc.time_ms":44.58100128173828,"stacktrace":"github.com/grpc-ecosystem/go-grpc-middleware/logging/zap.DefaultMessageProducer\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/options.go:212\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:39\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_PersistClick_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:362\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-15T23:38:18.781+0300","caller":"server/server.go:193","msg":"GRPC server stopping..."}
{"level":"info","ts":"2021-08-15T23:38:18.782+0300","caller":"server/server.go:195","msg":"GRPC server stopped"}
{"level":"info","ts":"2021-08-15T23:38:18.782+0300","caller":"otus_project/main.go:73","msg":"rotation service stopped"}
{"level":"info","ts":"2021-08-15T23:38:43.565+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-15T23:38:43.566+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-15T23:38:43.582+0300","caller":"otus_project/main.go:56","msg":"rotation service storage started"}
{"level":"info","ts":"2021-08-15T23:38:43.583+0300","caller":"server/server.go:180","msg":"GRPC server starting...","address":"localhost:56789"}
{"level":"info","ts":"2021-08-15T23:39:22.126+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-15T23:39:22+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"PersistClick","grpc.code":"OK","grpc.time_ms":11.184000015258789}
{"level":"error","ts":"2021-08-15T23:39:47.700+0300","caller":"zap/options.go:212","msg":"finished unary call with code Internal","grpc.start_time":"2021-08-15T23:39:47+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"NextBanner","error":"rpc error: code = Internal desc = failed to get next banner to show: failed to get total banner shows amount: sql GetBannerById result scan error: ERROR: syntax error at or near \"AND\" (SQLSTATE 42601)","grpc.code":"Internal","grpc.time_ms":12.11400032043457,"stacktrace":"github.com/grpc-ecosystem/go-grpc-middleware/logging/zap.DefaultMessageProducer\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/options.go:212\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:39\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:380\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-16T00:04:12.923+0300","caller":"server/server.go:193","msg":"GRPC server stopping..."}
{"level":"info","ts":"2021-08-16T00:04:12.926+0300","caller":"server/server.go:195","msg":"GRPC server stopped"}
{"level":"info","ts":"2021-08-16T00:04:12.926+0300","caller":"otus_project/main.go:73","msg":"rotation service stopped"}
{"level":"info","ts":"2021-08-16T00:32:31.167+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-16T00:32:31.168+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-16T00:34:01.597+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-16T00:34:01.597+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-16T00:34:01.625+0300","caller":"otus_project/main.go:56","msg":"rotation service storage started"}
{"level":"info","ts":"2021-08-16T00:34:01.625+0300","caller":"server/server.go:180","msg":"GRPC server starting...","address":"localhost:56789"}
{"level":"error","ts":"2021-08-16T00:34:43.055+0300","caller":"zapadapter@v0.0.0-20201125162808-c35f87e285f2/logger.go:33","msg":"QueryContext","time":1629063283,"duration":11.043598,"error":"ERROR: invalid input syntax for type uuid: \" a58e03cd-23ea-472d-82ba-21b350091bc8\" (SQLSTATE 22P02)","conn_id":"UUCWa2eoc4WIqGe4","query":"SELECT sb.banner_id, clicks_amount, shows_amount\n\t\t\t  FROM (select slot_id, banner_id\n\t\t  \t\t\tFROM slot_banners\n\t\t  \t\t\tWHERE slot_id = $1\n\t\t\t  ) as sb\n\t\t\t  left join banner_stats bs\n\t\t\t  ON sb.slot_id = bs.slot_id AND sb.banner_id = bs.banner_id AND group_id = $2","args":["9bdfb2e6-3e6c-4d18-906e-7315b84e0ddc"," a58e03cd-23ea-472d-82ba-21b350091bc8"],"stacktrace":"github.com/simukti/sqldb-logger/logadapter/zapadapter.(*zapAdapter).Log\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/simukti/sqldb-logger/logadapter/zapadapter@v0.0.0-20201125162808-c35f87e285f2/logger.go:33\ngithub.com/simukti/sqldb-logger.(*logger).log\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/simukti/sqldb-logger@v0.0.0-20201125162808-c35f87e285f2/logger.go:137\ngithub.com/simukti/sqldb-logger.(*connection).QueryContext\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/simukti/sqldb-logger@v0.0.0-20201125162808-c35f87e285f2/connection.go:208\ndatabase/sql.ctxDriverQuery\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/ctxutil.go:48\ndatabase/sql.(*DB).queryDC.func1\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:1650\ndatabase/sql.withLock\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:3294\ndatabase/sql.(*DB).queryDC\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:1645\ndatabase/sql.(*DB).query\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:1628\ndatabase/sql.(*DB).QueryContext\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:1605\ngithub.com/jmoiron/sqlx.(*DB).QueryxContext\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/jmoiron/sqlx@v1.3.4/sqlx_context.go:161\ngithub.com/jmoiron/sqlx.NamedQueryContext\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/jmoiron/sqlx@v1.3.4/named_context.go:120\ngithub.com/jmoiron/sqlx.(*DB).NamedQueryContext\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/jmoiron/sqlx@v1.3.4/sqlx_context.go:128\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).FindSlotBannerStats\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:389\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.NextBannerID\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:175\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).NextBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:150\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:378\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:380\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"error","ts":"2021-08-16T00:34:43.057+0300","caller":"zap/options.go:212","msg":"finished unary call with code Internal","grpc.start_time":"2021-08-16T00:34:43+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"NextBanner","error":"rpc error: code = Internal desc = failed to get next banner to show: failed to get banner statistics for a slot: error during sql execution: ERROR: invalid input syntax for type uuid: \" a58e03cd-23ea-472d-82ba-21b350091bc8\" (SQLSTATE 22P02)","grpc.code":"Internal","grpc.time_ms":14.119999885559082,"stacktrace":"github.com/grpc-ecosystem/go-grpc-middleware/logging/zap.DefaultMessageProducer\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/options.go:212\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:39\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:380\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-16T00:52:41.354+0300","caller":"server/server.go:193","msg":"GRPC server stopping..."}
{"level":"info","ts":"2021-08-16T00:52:41.357+0300","caller":"server/server.go:195","msg":"GRPC server stopped"}
{"level":"info","ts":"2021-08-16T00:52:41.358+0300","caller":"otus_project/main.go:73","msg":"rotation service stopped"}
{"level":"info","ts":"2021-08-16T00:52:48.914+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-16T00:52:48.914+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-16T00:52:48.928+0300","caller":"otus_project/main.go:56","msg":"rotation service storage started"}
{"level":"info","ts":"2021-08-16T00:52:48.929+0300","caller":"server/server.go:194","msg":"GRPC server starting...","address":"localhost:56789"}
{"level":"error","ts":"2021-08-16T00:53:02.281+0300","caller":"zapadapter@v0.0.0-20201125162808-c35f87e285f2/logger.go:33","msg":"QueryContext","time":1629064382,"duration":8.943672,"error":"ERROR: invalid input syntax for type uuid: \"9bdfb2e6-3e6c-4d18-906e-7315b84e0ddc\r a58e03cd-23ea-472d-82ba-21b350091bc8\" (SQLSTATE 22P02)","conn_id":"u4mcKkio2uYCQUKm","query":"SELECT sb.banner_id, clicks_amount, shows_amount\n\t\t\t  FROM (select slot_id, banner_id\n\t\t  \t\t\tFROM slot_banners\n\t\t  \t\t\tWHERE slot_id = $1\n\t\t\t  ) as sb\n\t\t\t  left join banner_stats bs\n\t\t\t  ON sb.slot_id = bs.slot_id AND sb.banner_id = bs.banner_id AND group_id = $2","args":["9bdfb2e6-3e6c-4d18-906e-7315b84e0ddc","9bdfb2e6-3e6c-4d18-906e-7315b84e0ddc\r a58e03cd-23ea-472d-82ba-21 (10 bytes truncated)"],"stacktrace":"github.com/simukti/sqldb-logger/logadapter/zapadapter.(*zapAdapter).Log\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/simukti/sqldb-logger/logadapter/zapadapter@v0.0.0-20201125162808-c35f87e285f2/logger.go:33\ngithub.com/simukti/sqldb-logger.(*logger).log\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/simukti/sqldb-logger@v0.0.0-20201125162808-c35f87e285f2/logger.go:137\ngithub.com/simukti/sqldb-logger.(*connection).QueryContext\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/simukti/sqldb-logger@v0.0.0-20201125162808-c35f87e285f2/connection.go:208\ndatabase/sql.ctxDriverQuery\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/ctxutil.go:48\ndatabase/sql.(*DB).queryDC.func1\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:1650\ndatabase/sql.withLock\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:3294\ndatabase/sql.(*DB).queryDC\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:1645\ndatabase/sql.(*DB).query\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:1628\ndatabase/sql.(*DB).QueryContext\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:1605\ngithub.com/jmoiron/sqlx.(*DB).QueryxContext\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/jmoiron/sqlx@v1.3.4/sqlx_context.go:161\ngithub.com/jmoiron/sqlx.NamedQueryContext\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/jmoiron/sqlx@v1.3.4/named_context.go:120\ngithub.com/jmoiron/sqlx.(*DB).NamedQueryContext\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/jmoiron/sqlx@v1.3.4/sqlx_context.go:128\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).FindSlotBannerStats\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:389\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.NextBannerID\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:175\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).NextBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:164\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:378\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:380\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"error","ts":"2021-08-16T00:53:02.285+0300","caller":"zap/options.go:212","msg":"finished unary call with code Internal","grpc.start_time":"2021-08-16T00:53:02+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"NextBanner","error":"rpc error: code = Internal desc = failed to get next banner to show: failed to get banner statistics for a slot: error during sql execution: ERROR: invalid input syntax for type uuid: \"9bdfb2e6-3e6c-4d18-906e-7315b84e0ddc\r a58e03cd-23ea-472d-82ba-21b350091bc8\" (SQLSTATE 22P02)","grpc.code":"Internal","grpc.time_ms":12.677000045776367,"stacktrace":"github.com/grpc-ecosystem/go-grpc-middleware/logging/zap.DefaultMessageProducer\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/options.go:212\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:39\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:380\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-16T00:53:25.516+0300","caller":"zapadapter@v0.0.0-20201125162808-c35f87e285f2/logger.go:35","msg":"QueryContext","time":1629064405,"duration":21.737473,"conn_id":"u4mcKkio2uYCQUKm","query":"SELECT sb.banner_id, clicks_amount, shows_amount\n\t\t\t  FROM (select slot_id, banner_id\n\t\t  \t\t\tFROM slot_banners\n\t\t  \t\t\tWHERE slot_id = $1\n\t\t\t  ) as sb\n\t\t\t  left join banner_stats bs\n\t\t\t  ON sb.slot_id = bs.slot_id AND sb.banner_id = bs.banner_id AND group_id = $2","args":["9bdfb2e6-3e6c-4d18-906e-7315b84e0ddc","a58e03cd-23ea-472d-82ba-21b350091bc8"]}
{"level":"error","ts":"2021-08-16T00:53:25.522+0300","caller":"zapadapter@v0.0.0-20201125162808-c35f87e285f2/logger.go:33","msg":"QueryContext","conn_id":"u4mcKkio2uYCQUKm","query":"SELECT SUM(shows_amount) FROM banner_stats WHERE slot_id = ? AND group_id = ?;","args":["9bdfb2e6-3e6c-4d18-906e-7315b84e0ddc","a58e03cd-23ea-472d-82ba-21b350091bc8"],"time":1629064405,"duration":4.743473,"error":"ERROR: syntax error at or near \"AND\" (SQLSTATE 42601)","stacktrace":"github.com/simukti/sqldb-logger/logadapter/zapadapter.(*zapAdapter).Log\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/simukti/sqldb-logger/logadapter/zapadapter@v0.0.0-20201125162808-c35f87e285f2/logger.go:33\ngithub.com/simukti/sqldb-logger.(*logger).log\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/simukti/sqldb-logger@v0.0.0-20201125162808-c35f87e285f2/logger.go:137\ngithub.com/simukti/sqldb-logger.(*connection).QueryContext\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/simukti/sqldb-logger@v0.0.0-20201125162808-c35f87e285f2/connection.go:208\ndatabase/sql.ctxDriverQuery\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/ctxutil.go:48\ndatabase/sql.(*DB).queryDC.func1\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:1650\ndatabase/sql.withLock\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:3294\ndatabase/sql.(*DB).queryDC\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:1645\ndatabase/sql.(*DB).query\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:1628\ndatabase/sql.(*DB).QueryContext\n\t/usr/local/Cellar/go/1.16.6/libexec/src/database/sql/sql.go:1605\ngithub.com/jmoiron/sqlx.(*DB).QueryRowxContext\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/jmoiron/sqlx@v1.3.4/sqlx_context.go:171\ngithub.com/Raschudesny/otus_project/v1/storage/sql.(*Storage).CountTotalShowsAmount\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/storage/sql/sql.go:365\ngithub.com/Raschudesny/otus_project/v1/internal.RotationService.NextBannerID\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/internal/rotation.go:189\ngithub.com/Raschudesny/otus_project/v1/server.(*RotationService).NextBanner\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/server.go:164\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler.func1\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:378\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:31\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:380\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"error","ts":"2021-08-16T00:53:25.524+0300","caller":"zap/options.go:212","msg":"finished unary call with code Internal","grpc.start_time":"2021-08-16T00:53:25+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"NextBanner","error":"rpc error: code = Internal desc = failed to get next banner to show: failed to get total banner shows amount: sql GetBannerById result scan error: ERROR: syntax error at or near \"AND\" (SQLSTATE 42601)","grpc.code":"Internal","grpc.time_ms":29.841999053955078,"stacktrace":"github.com/grpc-ecosystem/go-grpc-middleware/logging/zap.DefaultMessageProducer\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/options.go:212\ngithub.com/grpc-ecosystem/go-grpc-middleware/logging/zap.UnaryServerInterceptor.func1\n\t/Users/d.udovichenko/gopathdir/pkg/mod/github.com/grpc-ecosystem/go-grpc-middleware@v1.3.0/logging/zap/server_interceptors.go:39\ngithub.com/Raschudesny/otus_project/v1/server/pb._BannerRotationService_NextBanner_Handler\n\t/Users/d.udovichenko/Documents/workplace-projects/golang_otus/otus_project/server/pb/rotation_service_grpc.pb.go:380\ngoogle.golang.org/grpc.(*Server).processUnaryRPC\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1286\ngoogle.golang.org/grpc.(*Server).handleStream\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:1609\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.2\n\t/Users/d.udovichenko/gopathdir/pkg/mod/google.golang.org/grpc@v1.38.0/server.go:934"}
{"level":"info","ts":"2021-08-16T00:54:51.824+0300","caller":"server/server.go:207","msg":"GRPC server stopping..."}
{"level":"info","ts":"2021-08-16T00:54:51.828+0300","caller":"server/server.go:209","msg":"GRPC server stopped"}
{"level":"info","ts":"2021-08-16T00:54:51.833+0300","caller":"otus_project/main.go:73","msg":"rotation service stopped"}
{"level":"info","ts":"2021-08-16T00:54:57.671+0300","caller":"otus_project/main.go:42","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-16T00:54:57.672+0300","caller":"otus_project/main.go:46","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-16T00:54:57.693+0300","caller":"otus_project/main.go:56","msg":"rotation service storage started"}
{"level":"info","ts":"2021-08-16T00:54:57.693+0300","caller":"server/server.go:194","msg":"GRPC server starting...","address":"localhost:56789"}
{"level":"info","ts":"2021-08-16T00:55:07.833+0300","caller":"zapadapter@v0.0.0-20201125162808-c35f87e285f2/logger.go:35","msg":"QueryContext","duration":20.157485,"conn_id":"uwgGw6G24Cck_Oiy","query":"SELECT sb.banner_id, clicks_amount, shows_amount\n\t\t\t  FROM (select slot_id, banner_id\n\t\t  \t\t\tFROM slot_banners\n\t\t  \t\t\tWHERE slot_id = $1\n\t\t\t  ) as sb\n\t\t\t  left join banner_stats bs\n\t\t\t  ON sb.slot_id = bs.slot_id AND sb.banner_id = bs.banner_id AND group_id = $2","args":["9bdfb2e6-3e6c-4d18-906e-7315b84e0ddc","a58e03cd-23ea-472d-82ba-21b350091bc8"],"time":1629064507}
{"level":"info","ts":"2021-08-16T00:55:07.838+0300","caller":"zapadapter@v0.0.0-20201125162808-c35f87e285f2/logger.go:35","msg":"QueryContext","time":1629064507,"duration":4.094137,"conn_id":"uwgGw6G24Cck_Oiy","query":"SELECT SUM(shows_amount) FROM banner_stats WHERE slot_id = $1 AND group_id = $2;","args":["9bdfb2e6-3e6c-4d18-906e-7315b84e0ddc","a58e03cd-23ea-472d-82ba-21b350091bc8"]}
{"level":"info","ts":"2021-08-16T00:55:07.850+0300","caller":"zapadapter@v0.0.0-20201125162808-c35f87e285f2/logger.go:35","msg":"ExecContext","time":1629064507,"duration":11.982727,"conn_id":"uwgGw6G24Cck_Oiy","query":"UPDATE banner_stats \n\t\t\t  SET shows_amount = shows_amount + 1 \n\t\t\t  WHERE slot_id = $1 AND group_id = $2 AND banner_id = $3","args":["9bdfb2e6-3e6c-4d18-906e-7315b84e0ddc","a58e03cd-23ea-472d-82ba-21b350091bc8","5c15f422-279e-4f30-b7f9-dd507cb8a4d8"]}
{"level":"info","ts":"2021-08-16T00:55:07.850+0300","caller":"zap/options.go:212","msg":"finished unary call with code OK","grpc.start_time":"2021-08-16T00:55:07+03:00","system":"grpc","span.kind":"server","grpc.service":"banner_rotation.BannerRotationService","grpc.method":"NextBanner","grpc.code":"OK","grpc.time_ms":36.91400146484375}
{"level":"info","ts":"2021-08-16T00:55:28.168+0300","caller":"server/server.go:207","msg":"GRPC server stopping..."}
{"level":"info","ts":"2021-08-16T00:55:28.169+0300","caller":"server/server.go:209","msg":"GRPC server stopped"}
{"level":"info","ts":"2021-08-16T00:55:28.169+0300","caller":"otus_project/main.go:73","msg":"rotation service stopped"}
{"level":"info","ts":"2021-08-16T06:39:05.360+0300","caller":"cmd/main.go:45","msg":"Banner rotation service starting..."}
{"level":"info","ts":"2021-08-16T06:39:05.363+0300","caller":"cmd/main.go:49","msg":"rotation service storage starting..."}
{"level":"info","ts":"2021-08-16T06:39:05.388+0300","caller":"cmd/main.go:59","msg":"rotation service storage started"}
{"level":"info","ts":"2021-08-16T06:39:05.388+0300","caller":"server/server.go:196","msg":"GRPC server starting...","address":"localhost:56789"}
{"level":"info","ts":"2021-08-16T06:39:12.512+0300","caller":"server/server.go:209","msg":"GRPC server stopping..."}
{"level":"info","ts":"2021-08-16T06:39:12.512+0300","caller":"server/server.go:211","msg":"GRPC server stopped"}
{"level":"info","ts":"2021-08-16T06:39:12.513+0300","caller":"cmd/main.go:77","msg":"rotation service stopped"}
